#!/bin/bash
# 
# Date : 2020.10.20
# 목적 : HamoniKR 4.0 시스템 패키지 인스톨

# change fast apt mirror in korea
sed -i 's/packages.linuxmint.com/mirrors.evowise.com\/linuxmint\/packages/g' /etc/apt/sources.list.d/official-package-repositories.list
sed -i 's/archive.ubuntu.com/mirror.kakao.com/g' /etc/apt/sources.list.d/official-package-repositories.list
sed -i 's/kr.archive.ubuntu.com/mirror.kakao.com/g' /etc/apt/sources.list.d/official-package-repositories.list
sed -i 's/security.ubuntu.com/mirror.kakao.com/g' /etc/apt/sources.list.d/official-package-repositories.list
sed -i 's/extras.ubuntu.com/mirror.kakao.com/g' /etc/apt/sources.list.d/official-package-repositories.list

# 하모니카 저장소 추가
curl -sL https://pkg.hamonikr.org/add-hamonikr-jin.apt | sudo -E bash -

# 최신 커널 설치
sudo apt-get --only-upgrade install -y linux-image-generic

# 이전 커널 제거(추후 작업시 버전 변경이 필요할 수 있습니다.)
sudo apt-get --purge remove -y linux-image-5.4.0-26-generic
sudo apt-get --purge remove -y linux-headers-5.4.0-26
sudo apt-get --purge remove -y linux-headers-5.4.0-26-generic
sudo apt-get --purge remove -y linux-modules-5.4.0-26-generic
sudo apt-get --purge remove -y linux-modules-extra-5.4.0-26-generic

echo "\033[31m"'---------------------------------------------'"\033[0m"
echo "\033[32m"' livecd 커널 변경은 chroot작업이 끝나고 이루어집니다. '"\033[0m"
echo "\033[31m"'---------------------------------------------'"\033[0m"
# ※ extract-cd > casper > vmlinuz는 chroot 작업이 끝나고 custom-img > edit > boot > vmlinuz-5.4.0-xx-generic 파일 복사
# ※ extract-cd > casper > initrd.lz는 chroot 작업이 끝나고 custom-img > edit > boot > initrd-5.4.0-xx-generic 파일 복사

#sudo apt-get upgrade -y

sudo apt-get install -y hamonikr-system-settings

# 데스크톱 환경
sudo apt-get install -y hamonikr-desktop-environment

# 하모니카 테마팩
sudo apt-get install -y hamonikr-themes

# 하모니카 아이콘팩
sudo apt-get install -y hamonikr-jin-icon-theme

# 라이브 부팅 CD 설치 인스톨러에 나오는 슬라이드 쇼
sudo apt-get install -y ubiquity-slideshow-mint

# 님프 관련 설정
im-config -n nimf
# 라이브시디에서 한글키보드를 사용하려면 nimf 설정의 XKB 옵션 중 Hangule 키를 Right Alt 사용으로 체크
# sed -i "s/\[''\]/\['korean:ralt_rctrl'\]/g" /usr/share/glib-2.0/schemas/org.nimf.settings.gschema.xml

# 온보드
sudo apt-get install -y hamonikr-onboard-layout-ko

# 한글 언어팩 설치
sudo apt-get install -y language-pack-ko
# 한글 언어팩 설정(/etc/default/locale)
#sudo update-locale

# albert
# Full example for Ubuntu 20.04
curl https://build.opensuse.org/projects/home:manuelschneid3r/public_key | sudo apt-key add -
echo 'deb http://download.opensuse.org/repositories/home:/manuelschneid3r/xUbuntu_20.04/ /' | sudo tee /etc/apt/sources.list.d/home:manuelschneid3r.list
sudo wget -nv https://download.opensuse.org/repositories/home:manuelschneid3r/xUbuntu_20.04/Release.key -O "/etc/apt/trusted.gpg.d/home:manuelschneid3r.asc"
sudo apt update
sudo apt install albert
